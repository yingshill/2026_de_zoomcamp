id: business-processes
namespace: tutorial
labels:
  name: Business Processes

inputs:
  - id: request.name
    type: STRING
    defaults: Rick Astley

  - id: request.start_date
    type: DATE
    defaults: 2024-07-01

  - id: request.end_date
    type: DATE
    defaults: 2024-07-07

  - id: slack_webhook_uri
    type: URI
    defaults: https://kestra.io/api/mock

tasks:
  - id: send_approval_request
    type: io.kestra.plugin.slack.SlackIncomingWebhook
    description: Send a Slack message requesting approval for the vacation.
    url: "{{ inputs.slack_webhook_uri }}"
    payload: |
      {
        "channel": "#vacation",
        "text": "Validate holiday request for {{ inputs.request.name }}. To approve the request, click on the `Resume` button here http://localhost:8080/ui/executions/{{flow.namespace}}/{{flow.id}}/{{execution.id}}"
      }

  - id: wait_for_approval
    type: io.kestra.plugin.core.flow.Pause
    description: Pause the flow while waiting for manual approval.
    pauseDuration: PT30S

  - id: process_request
    type: io.kestra.plugin.core.http.Request
    description: Submit the approved vacation request to the API.
    uri: https://kestra.io/api/mock
    method: POST
    contentType: application/json
    body: "{{ inputs.request }}"

description: |
  # Flow Description
  **Use case:** Vacation approval workflow that mixes human validation with automated follow-up.
  **Highlights:**
  - Collect request details (name and dates) via generated form inputs.
  - Notify approvers in Slack with a link to resume the execution.
  - Pause the flow until a user clicks `Resume` in the Kestra UI.
  - Submit the approved vacation request to the API once approval is granted.
